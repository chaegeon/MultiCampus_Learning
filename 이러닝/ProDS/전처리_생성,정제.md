# 데이터 전처리

## 데이터 생성, 데이터 정제

- 데이터 마이닝
  - 대용량 데이터로부터 패턴을 파악하고 정보를 만들어 냄
- 머신러닝 알고리즘
  - 데이터의 패턴을 파악하는데 사용되는 알고리즘

```
#요약변수 #파생변수 #이상치 #결측치 #Binning
```

### 데이터 생성

- 요약변수
  - 수집된 정보를 분석의 못적에 맞게 종합한 변수(aggregate)
    - 방식은 누가봐도 똑같은 결과가 나올 수 있는, 객관적인 원리에 의해 종합되어야 함
    - Ex). 단어빈도, 상품별 구매금액, 상품별 구매량, 영화 매출액 등등
  - 재활용성이 높음

- 파생변수

  - 특정한 의미를 갖는 작위적 정의에 의한 변수
  - 사용자가 특정조건을 만족하거나 특정 함수에 의해 값을 만들어 의미를 부여한 변수
  - 매우 주관적일 수 있으므로 논리작 타당성을 갖추어야 함
    - Ex). 구매상품 다양성 변수, 가격 선호대 변수, 라이프 스타일 변수, 영화 인기도 변수
    - 다양하다는 걸 어떻게 정의할 것인가, 어느만큼을 좋아해야 선호하는 것인지, 라이프 스타일을 어떻게 분류할 것인지, 어느수준이어야 인기있는 수준인지 등등


### 데이터 정제

#### 결측값의 이해 ( Missing Value)

- 기록누락, 미응답, 수집오류(오표기) 등의 이유로 결측이 발생
- 결측값이 포함된 자료라도 나머지 변수의 값들은 의미있는 정보이므로, 정보의 손실을 최소하 하도록 결측을 처리하는 것이 바람직
- 가능하면 모든 정보를 반영하도록 하는 것이 바람직함
- 가능한 남아있는 값이라도 잘 살리기 위해 결측치를 적절한 값으로 대체하는 방법들


#### 결측값 처리 방법

- 완전제거법(list-wise deletion)
  - 결측값이 하나 이상 포함된 자료를 제거하는 방법
  - 정보의 손실로 분석결과가 왜곡될 수 있음

- 평균대체법(mean value imputation)

- 적절한 값으로 대체하는 방법 중 가장 단순하면서 가장 많이 활용되는 방법
- 결측값을 해당 변수의 나머지 값들의 평균으로 대체하는 방법
- Ex). `5, NaN, 17` => `5, 11, 17`
- 추정량의 표준오차가 과소추정되는 문제가 있음
  - 5, NaN, 17 만약 실제 결측치의 값이 5와 17사이가 아니라 동떨어진 값일 수도 있음.
    - Ex). 5, 29, 17 이었을 수도..
    - -> 이 자료의 변동성은 원래 5, 17, 29 만큼의 변동성을 가지는 자료였는데 평균으로 대체하면서 자료의 변동성이 작게 측정이 된 것.
    - -> 자료의 변동성이 작다면 추정의 오차가 줄어들게 되는데, 실제 데이터의 변동성은 그렇지 않음 
    - -> 변동성이 작을 것이라고 가정을 하고 '추정이 잘 될 거다', '추정 오차가 줄어들 것이다' 라고 잘못된 판단을 할 수가 있는거임
  - 어떤 추정을 했을 때 그 추정의 오차가 분석에서 제시한 값보다 훨씬 클수가 있다는 것을 염두에 둬야 함

- 핫덱대체법(hot deck imputation)

  - 동일한 데이터 내에서 결측값이 발생한 관찰치와 유사한 특성을 가진 다른 관찰치의 정보를 이용하여 대체하는 방법
    - 여러개라면 여러개를 모아서 랜덤으로 선택
  - Ex). 소득정보는 NaN, 나이 30, 자녀수2
  - -> 소득이 관찰된 나이30, 자녀수2의 다른 자료를 다 모음
  - -> 그 자료중 하나의 정보를 랜덤하게 선택한 다음 그 정보의 소득값을 결측치에 대체
  - -> 소득100, 나이30, 자녀수2 를 선택했을 경우 처음 자료의 소득 NaN을 100으로 대체


- 그 밖의 결측값 처리법

- 모델을 이용해서 처리하는 방법
  - Regression imputation
    - Regression 모델
    - Ex). 나이와 자녀수와 소득이 어떤 연관이 있을것이다
    - -> 나이와 자녀수를 이용해서 어떤 함수를 취함녀 소득을 예측할 수 있을 것이다 라고 가정
    - 소득이 관찰된 나머지 자료들을 가져옴(다양한 나이와 자녀수)
    - -> 결측이 없는 자료를 대상으로, 나이와 자녀수를 이용해서 소득을 설명하고자 하는 어떤 함수를 추정
    - -> 추정된 함수를 갖와 나이가 30, 자녀수2 면 소득이 얼마로 예측될까. 모델을 이용해서 소득을 예측하고 예측된 값으로 missing을 채움
  - kNN imputation
    - K-nearest neighbor라는 알고리즘을 이용해서 선택
    - 어떤 관찰치와 가장 유사한 k개의 관찰치자료를 선택하고 그 자료들의 소득의 평균 등으로 대체하는 방식



#### 이상값의 이해

- 이상값은 다른 데이터와 동떨어진 것을 말함
- 다른 자료값들에 비해 멀리 떨어져 있지만 의미가 있는 값일 수도 있고, 단순히 입력 오류로 발생한 값일 수도 있음
- 단순한 입력오류라면 수정하면 그만
- 입력오류인데 원래 값을 모르겠다 -> 제거 ( 잘못된 정보에 해당하니)
- 유의미한 자료라면?
  - 이상값을 포함한 분석과 포함하지 않은 분석을 진행해본다음, 비교하며 이상값의 효과를 정리해보는 방법이 도울이 될거임


#### 이상값의 탐지

- 상자그림

  - <img src="C:\Users\chgeo\AppData\Roaming\Typora\typora-user-images\image-20220208000702254.png" alt="image-20220208000702254" style="zoom:200%;" />
  - `Q1 - 1.5 * IQR` 과 `Q3 + 1.5 * IQR`의 범위를 넘어가는 자료를 이상값으로 진단
  - 가운데 박스가 데이터의 Q1, Q3를 경계로 그려진 박스
  - 데이터에서 Q1보다 작은게 25%, Q3보다 큰게 25%
  - 각각 4등분을 하는 지점에서 첫번째, 3번째 경계에 해당한다고 볼 수 있음
  - Q2는 Median. 중앙값. 이에 해당하는 부분에 칸막이를 쳐줌(선)
  - Q1, Q2, Q3에 의해서 자료 전체가 4등분이 된다고 이해할 수 있음
  - 4등분 했을 때 가운데 50%에 해당하는 부분을 박스로 그리고
  - 이 박스의 길이를 IQR(Inter Quartile range)
  - 이 IQR을 박스 양 끝에서 IQR의 1.5배만큼 범위를 지정
  - Q1 에서 (IQR * 1.5)을  빼준 값, Q3에서 (IQR*1.5)를 더한 값
  - 이 범위 안에 들어오는 자료가 있다면 정상값으로 진단
  - 이 범위를 넘어서는 값이 있다면 이상값으로 진단
  - box plot에서는 범위안의 가장 극단적인 값까지는 선으로 표현, 범위 밖의 이상값은 기호,점 등의 다른 방식으로 표현해 줌
  - 이 때 1.5배 IQR의 이 1.5를 투키 tukey의 계수라고 부름
  - 이 tukey의 계수는 자료에 따라 다른 값을 줄 수도 있음
  - 만약 이 계수를 적용했을 때 극단치가 매우 많이 존재할 것 같으면? -> 그렇게 많이 존재하면 이상치가 아니지
  - 1.5라는 계수 대신 3이나 5등 값을 좀 키워서 판단을 하게 됨